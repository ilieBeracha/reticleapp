---
alwaysApply: true
---

# Expo Router + React Native Project Rules

## Core Expo Router Principles

1. **All routes MUST be files inside `/src/app` directory**
   - Every file with default export = a route
   - Exception: `_layout.tsx` files (layouts, not routes)
   
2. **All pages have a URL** - File path = URL path
   - `app/index.tsx` ‚Üí `/`
   - `app/home.tsx` ‚Üí `/home`
   - `app/profile/settings.tsx` ‚Üí `/profile/settings`

3. **First `index.tsx` is the initial route**
   - `app/index.tsx` or `app/(tabs)/index.tsx` = landing page
   - Use route groups `(name)` for organization without affecting URL

4. **Root `_layout.tsx` is required** - Replaces `App.tsx`
   - Put initialization code here (fonts, splash screen)
   - Located at `src/app/_layout.tsx`

5. **Non-route code lives OUTSIDE app directory**
   - Components ‚Üí `src/components/`
   - Hooks ‚Üí `src/hooks/`
   - Utils ‚Üí `src/utils/`
   - Types ‚Üí `src/types/`

6. **React Navigation under the hood**
   - Use React Navigation docs for advanced configs
   - Same options for Stack, Tabs, Drawer navigators

## Project Structure

```
‚îú‚îÄ‚îÄ assets/                      # Images, fonts, static files
‚îú‚îÄ‚îÄ scripts/                     # Build scripts
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/                     # üö® ROUTES ONLY - File-based routing
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ (tabs)/             # Route group (not in URL)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ _layout.tsx     # Tabs navigator
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.tsx       # First tab
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ profile.tsx     # Second tab
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/                # API routes
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user+api.ts     # /api/user endpoint
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ posts+api.ts    # /api/posts endpoint
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ modal.tsx           # /modal route
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ _layout.tsx         # Root layout
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.tsx           # / route
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ components/             # Reusable components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/                 # Base UI (Button, Input, Card)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ features/           # Feature-specific components
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ screens/                # Screen implementations (optional pattern)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Home/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ components/     # Screen-specific components
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ index.tsx       # Main screen component
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ hooks/                  # Custom hooks
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useAuth.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useTheme.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ utils/                  # Helper functions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ formatDate.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ formatDate.test.ts  # Colocated tests
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ server/                 # Server-only code (for +api routes)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ db.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ types/                  # TypeScript types
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ constants/              # App constants
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Colors.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Config.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ styles/                 # Global styles
‚îÇ       ‚îî‚îÄ‚îÄ theme.ts
‚îÇ
‚îú‚îÄ‚îÄ app.json
‚îú‚îÄ‚îÄ eas.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îî‚îÄ‚îÄ package.json
```

## File Naming Conventions

### Routes (in `app/` only)
- `index.tsx` - Default route for directory
- `[id].tsx` - Dynamic route segment
- `[...slug].tsx` - Catch-all dynamic route
- `(group)` - Route group (doesn't affect URL)
- `_layout.tsx` - Layout file (not a route)
- `+api.ts` - API route (server-side)
- `+not-found.tsx` - 404 page

### Components
- `Button.tsx` - Single file component (PascalCase)
- `Button/index.tsx` - Multi-file component
- `Button/Button.styles.ts` - Separate styles (avoid this)
- `Button.web.tsx` - Platform-specific component
- `Button.test.tsx` - Colocated test

### Others
- `useAuth.ts` - Custom hooks (camelCase with 'use' prefix)
- `formatDate.ts` - Utilities (camelCase)
- `types.ts` - Type definitions

## _layout.tsx Patterns

### Root Layout (`app/_layout.tsx`)
```typescript
import { Stack } from 'expo-router';
import { useFonts } from 'expo-font';
import * as SplashScreen from 'expo-splash-screen';
import { useEffect } from 'react';

SplashScreen.preventAutoHideAsync();

export default function RootLayout() {
  const [loaded, error] = useFonts({
    'Inter': require('../assets/fonts/Inter.ttf'),
  });

  useEffect(() => {
    if (loaded || error) {
      SplashScreen.hideAsync();
    }
  }, [loaded, error]);

  if (!loaded && !error) {
    return null;
  }

  return (
    <Stack screenOptions={{ headerShown: false }}>
      <Stack.Screen name="(tabs)" options={{ headerShown: false }} />
      <Stack.Screen name="modal" options={{ presentation: 'modal' }} />
    </Stack>
  );
}
```

### Tabs Layout (`app/(tabs)/_layout.tsx`)
```typescript
import { Tabs } from 'expo-router';
import { Ionicons } from '@expo/vector-icons';

export default function TabLayout() {
  return (
    <Tabs screenOptions={{ tabBarActiveTintColor: 'blue' }}>
      <Tabs.Screen
        name="index"
        options={{
          title: 'Home',
          tabBarIcon: ({ color }) => <Ionicons name="home" size={24} color={color} />,
        }}
      />
      <Tabs.Screen
        name="profile"
        options={{
          title: 'Profile',
          tabBarIcon: ({ color }) => <Ionicons name="person" size={24} color={color} />,
        }}
      />
    </Tabs>
  );
}
```

### Stack Layout (`app/settings/_layout.tsx`)
```typescript
import { Stack } from 'expo-router';

export default function SettingsLayout() {
  return (
    <Stack>
      <Stack.Screen name="index" options={{ title: 'Settings' }} />
      <Stack.Screen name="privacy" options={{ title: 'Privacy' }} />
    </Stack>
  );
}
```

## Component Rules

### Component Structure
```typescript
import { View, Text, StyleSheet } from 'react-native';

interface ButtonProps {
  title: string;
  onPress: () => void;
  variant?: 'primary' | 'secondary';
}

export function Button({ title, onPress, variant = 'primary' }: ButtonProps) {
  return (
    <View style={styles.container}>
      <Text style={styles.text}>{title}</Text>
    </View>
  );
}

// Styles at bottom of file (colocated)
const styles = StyleSheet.create({
  container: {
    padding: 16,
  },
  text: {
    fontSize: 16,
  },
});
```

### Component Organization
- One named export per file (same name as filename)
- Props interface above component
- Styles at bottom using `StyleSheet.create`
- Break large components into folder with `index.tsx`

```
components/
  ‚îú‚îÄ‚îÄ Table/
  ‚îÇ   ‚îú‚îÄ‚îÄ components/
  ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Row.tsx
  ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Cell.tsx
  ‚îÇ   ‚îî‚îÄ‚îÄ index.tsx          # Main Table component
  ‚îî‚îÄ‚îÄ Button.tsx             # Simple single-file component
```

## Screen Pattern (Optional but Recommended)

For complex screens, use the `/screens` folder pattern:

```typescript
// app/index.tsx - Route file
import { Home } from '@/screens/Home';

export default function HomePage() {
  // Handle route-specific logic (params, navigation)
  return <Home />;
}

// screens/Home/index.tsx - Screen implementation
export function Home() {
  // Screen UI and logic
  return <View>...</View>;
}
```

Benefits:
- Separates route concerns from UI
- Allows complex screen breakdown
- Easy to reuse screens in multiple routes

## Platform-Specific Code

Use file extensions for platform-specific implementations:

```
components/
  ‚îú‚îÄ‚îÄ BarChart.tsx           # Default (required)
  ‚îú‚îÄ‚îÄ BarChart.web.tsx       # Web version
  ‚îú‚îÄ‚îÄ BarChart.native.tsx    # Native (iOS + Android)
  ‚îú‚îÄ‚îÄ BarChart.ios.tsx       # iOS only
  ‚îî‚îÄ‚îÄ BarChart.android.tsx   # Android only
```

Import without extension:
```typescript
import { BarChart } from '@/components/BarChart';
// Metro picks correct file based on platform
```

**Rules:**
- Always have a default file (no extension)
- Props must be identical across all versions
- Extensions: `.web`, `.native`, `.ios`, `.android`

## API Routes

API routes use `+api.ts` suffix and live in `app/api/`:

```typescript
// app/api/user+api.ts
export async function GET(request: Request) {
  return Response.json({ user: 'data' });
}

export async function POST(request: Request) {
  const body = await request.json();
  return Response.json({ success: true });
}
```

**Rules:**
- Place all API routes in `app/api/` folder
- Use `process.env.SECRET` for sensitive vars (not `EXPO_PUBLIC_`)
- Extract shared logic to `src/server/`
- Add ESLint rules for server-only code

## Navigation

### Navigate Between Routes
```typescript
import { router } from 'expo-router';

// Navigate
router.push('/profile');
router.replace('/login');

// With params
router.push('/profile/123');
router.push({ pathname: '/profile/[id]', params: { id: '123' } });

// Go back
router.back();
```

### Use Route Params
```typescript
// app/profile/[id].tsx
import { useLocalSearchParams } from 'expo-router';

export default function ProfilePage() {
  const { id } = useLocalSearchParams();
  return <Text>Profile {id}</Text>;
}
```

### Links
```typescript
import { Link } from 'expo-router';

<Link href="/profile">Go to Profile</Link>
<Link href="/profile/123">Profile 123</Link>
```

## TypeScript Rules

- **Always use TypeScript** for all `.tsx` and `.ts` files
- Define props interfaces for all components
- Use `type` for simple shapes, `interface` for extendable types
- Export types from `src/types/` for reuse
- Avoid `any` - use `unknown` if type is truly unknown

## Styling Best Practices

1. **Colocate styles** - Keep StyleSheet at bottom of component file
2. **Don't use separate `.styles.ts` files** - Outdated pattern
3. **Use StyleSheet.create** for performance
4. **Consider NativeWind/Tailwind** for utility-first styling
5. **Global theme** in `src/styles/theme.ts`

```typescript
// ‚úÖ Good - Colocated
export function Button() {
  return <View style={styles.container} />;
}

const styles = StyleSheet.create({
  container: { padding: 16 },
});

// ‚ùå Avoid - Separate file
import { styles } from './Button.styles';
```

## Testing

- Colocate unit tests with files: `formatDate.test.ts` next to `formatDate.ts`
- Integration tests can go in `__tests__/` folder
- Use descriptive test names

## Import Aliases

Configure in `tsconfig.json`:
```json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./src/*"],
      "@/components/*": ["./src/components/*"],
      "@/hooks/*": ["./src/hooks/*"],
      "@/utils/*": ["./src/utils/*"],
      "@/screens/*": ["./src/screens/*"]
    }
  }
}
```

Use in code:
```typescript
import { Button } from '@/components/ui/Button';
import { useAuth } from '@/hooks/useAuth';
import { formatDate } from '@/utils/formatDate';
```

## Common Mistakes to Avoid

‚ùå **Don't put components in `app/` directory**
```
app/
  components/  # ‚ùå Wrong - Expo Router treats as route
```

‚úÖ **Put components outside app/**
```
src/
  app/         # ‚úÖ Routes only
  components/  # ‚úÖ Components here
```

---

‚ùå **Don't manually define initial route**
```typescript
// ‚ùå No initialRouteName in Expo Router
<Stack initialRouteName="Home">
```

‚úÖ **Use index.tsx for initial route**
```
app/index.tsx  # ‚úÖ This is your initial route
```

---

‚ùå **Don't ignore route groups**
```
app/tabs/  # ‚ùå URL becomes /tabs/home
```

‚úÖ **Use parentheses for groups**
```
app/(tabs)/  # ‚úÖ URL is just /home
```

---

‚ùå **Don't export default from components**
```typescript
// components/Button.tsx
export default function Button() {}  // ‚ùå Avoid
```

‚úÖ **Use named exports**
```typescript
// components/Button.tsx
export function Button() {}  // ‚úÖ Better for refactoring
```

---

## Environment Variables

- `EXPO_PUBLIC_*` - Available in client code
- `process.env.*` - Available in API routes only
- Store in `.env` file
- Never commit secrets to git

## Performance Tips

1. Use `React.memo` for expensive components
2. Optimize images with `expo-image`
3. Lazy load screens with `React.lazy` where appropriate
4. Use `FlatList` for large lists, never `ScrollView`
5. Minimize bridge crossings (minimize native module calls)

## Summary

- **Routes live in `app/` ONLY** - Everything else outside
- **Use `_layout.tsx`** at each navigation level
- **Colocate related files** - tests, sub-components
- **Platform-specific** with file extensions
- **Named exports** for components
- **TypeScript everywhere**
- **Import aliases** for clean imports